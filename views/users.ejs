<!DOCTYPE html>
<html>
<head>
    <title>會員管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="theme-color" content="#388697">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #388697;
            --bg-color: #F2F4F6;
            --card-bg: #FFFFFF;
            --text-main: #1C1C1E;
            --danger-color: #FF3B30;
            --success-color: #34C759;
            --radius-lg: 20px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --header-height: 60px;
        }
        body {
            background-color: var(--bg-color); color: var(--text-main);
            padding-top: calc(var(--header-height) + 20px); padding-bottom: 100px;
            min-height: 100vh; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        /* Header */
        .top-nav {
            position: fixed; top: 0; left: 0; right: 0; height: var(--header-height);
            background: var(--primary-color); color: white;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            z-index: 1000; padding-top: env(safe-area-inset-top); height: calc(var(--header-height) + env(safe-area-inset-top));
            box-shadow: 0 4px 12px rgba(56, 134, 151, 0.2);
        }
        .top-nav-title { font-weight: 700; font-size: 18px; }
        .nav-btn { color: white; font-size: 1.2rem; text-decoration: none; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;}

        /* Modern List */
        .modern-list { background: var(--card-bg); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm); }
        .list-item { padding: 16px; border-bottom: 1px solid #F2F4F6; display: flex; justify-content: space-between; align-items: center; }
        .list-item:last-child { border-bottom: none; }
        
        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 80px; background: #FFFFFF;
            border-top: 1px solid rgba(0,0,0,0.05); display: flex; justify-content: space-around; align-items: flex-start;
            padding-top: 12px; z-index: 1000; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #C7C7CC; font-size: 0.75rem; font-weight: 500; width: 60px; }
        .nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary-color); }
        
        .action-btn-container { position: fixed; bottom: 90px; left: 20px; right: 20px; z-index: 900; }
        .action-btn { width: 100%; border-radius: 16px; font-size: 1.1rem; font-weight: 700; padding: 14px; box-shadow: 0 8px 20px rgba(56, 134, 151, 0.3); border: none; background: var(--primary-color); color: white; }
    </style>
</head>
<body>

<div class="top-nav">
    <a href="/activity/<%= activity.id %>" class="nav-btn"><i class="fa-solid fa-chevron-left"></i></a>
    <div class="top-nav-title">會員管理</div>
    <div style="width: 40px;"></div>
</div>

<div class="container">
    <div class="modern-list">
        <% users.forEach(user => { %>
            <div class="list-item">
                <div class="d-flex align-items-center gap-3">
                    <div style="font-weight: 600;"><%= user.name %></div>
                    <% if(user.is_pool_member) { %>
                        <div class="<%= user.balance < 0 ? 'text-danger' : 'text-success' %> fw-bold">$<%= user.balance.toFixed(2) %></div>
                    <% } else { %>
                        <span class="badge bg-light text-secondary">Cash</span>
                    <% } %>
                </div>
                <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-light text-success btn-deposit" data-id="<%= user.id %>" data-name="<%= user.name %>"><i class="fa-solid fa-money-bill-wave"></i></button>
                    <button class="btn btn-sm btn-light text-primary btn-edit-user" data-id="<%= user.id %>" data-name="<%= user.name %>"><i class="fa-solid fa-pen"></i></button>
                    <button class="btn btn-sm btn-light text-danger btn-delete-user" data-id="<%= user.id %>" data-name="<%= user.name %>"><i class="fa-solid fa-trash"></i></button>
                </div>
            </div>
        <% }) %>
    </div>
</div>

<div class="action-btn-container">
    <button class="action-btn" type="button" data-bs-toggle="modal" data-bs-target="#addUserModal">
        <i class="fa-solid fa-plus me-1"></i> 加新會員
    </button>
</div>

<div class="modal fade" id="addUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">加新會員</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/add-user" method="POST"><div class="modal-body"><input type="text" name="name" class="form-control" placeholder="Name" required></div><div class="modal-footer"><button type="submit" class="btn btn-primary w-100">加入</button></div></form></div></div></div>
<div class="modal fade" id="depositModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-success">入錢</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/deposit" method="POST"><div class="modal-body"><input type="hidden" name="userId" id="depositUserId"><p>入錢給： <strong id="depositUserName"></strong></p><input type="number" step="0.01" name="amount" id="depositAmount" class="form-control fw-bold fs-4" placeholder="100.00" value="100" required></div><div class="modal-footer"><button type="submit" class="btn btn-success w-100">確定</button></div></form></div></div></div>
<div class="modal fade" id="editUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">改名</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/edit-user" method="POST"><div class="modal-body"><input type="hidden" name="id" id="editUserId"><input type="text" name="name" id="editUserName" class="form-control" required></div><div class="modal-footer"><button type="submit" class="btn btn-primary w-100">保存</button></div></form></div></div></div>
<div class="modal fade" id="deleteUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-danger">刪除會員</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/delete-user" method="POST"><div class="modal-body"><input type="hidden" name="id" id="deleteUserId"><p>確定刪除 <strong id="deleteUserName"></strong>？</p></div><div class="modal-footer"><button type="submit" class="btn btn-danger w-100">刪除</button></div></form></div></div></div>

<div class="bottom-nav">
    <a href="/activity/<%= activity.id %>" class="nav-item"><i class="fa-solid fa-pen-to-square"></i><span>記數</span></a>
    <a href="/activity/<%= activity.id %>/history" class="nav-item"><i class="fa-solid fa-clock-rotate-left"></i><span>紀錄</span></a>
    <a href="/activity/<%= activity.id %>/users" class="nav-item active"><i class="fa-solid fa-users"></i><span>成員</span></a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    var editUserModal = new bootstrap.Modal(document.getElementById('editUserModal')), deleteUserModal = new bootstrap.Modal(document.getElementById('deleteUserModal')), depositModal = new bootstrap.Modal(document.getElementById('depositModal'));
    document.querySelectorAll('.btn-deposit').forEach(b => b.addEventListener('click', function() { document.getElementById('depositUserId').value = this.dataset.id; document.getElementById('depositUserName').innerText = this.dataset.name; document.getElementById('depositAmount').value = '100'; depositModal.show(); }));
    document.querySelectorAll('.btn-edit-user').forEach(b => b.addEventListener('click', function() { document.getElementById('editUserId').value = this.dataset.id; document.getElementById('editUserName').value = this.dataset.name; editUserModal.show(); }));
    document.querySelectorAll('.btn-delete-user').forEach(b => b.addEventListener('click', function() { document.getElementById('deleteUserId').value = this.dataset.id; document.getElementById('deleteUserName').innerText = this.dataset.name; deleteUserModal.show(); }));
    document.querySelectorAll('form').forEach(form => { form.addEventListener('submit', (e) => { const btn = form.querySelector('button[type="submit"]'); if (btn) { btn.disabled = true; btn.innerText = "處理中..."; } }); });
</script>
</body>
</html>