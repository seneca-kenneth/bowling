<!DOCTYPE html>
<html>
<head>
    <title>æœƒå“¡ç®¡ç†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="theme-color" content="#388697">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .bg-primary { background-color: #388697 !important; }
        .text-primary { color: #388697 !important; }
        .btn-outline-primary { color: #388697; border-color: #388697; }
        .btn-outline-primary:hover, .btn-primary { background-color: #388697; border-color: #388697; color: white; }
        .btn-outline-success { color: #198754; border-color: #198754; }
        .btn-outline-success:hover { background-color: #198754; color: white; }
        body { padding-bottom: 100px; background-color: #f8f9fa; }
        .sticky-footer { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; border-top: 1px solid #eee; }
        .dropdown-item { padding: 10px 15px; font-size: 1rem; }
        ::-webkit-scrollbar { display: none; }
        html, body { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-primary mb-3">
    <div class="container-fluid position-relative">
        <div class="d-flex align-items-center">
            <a class="navbar-brand p-0 m-0" href="/activity/<%= activity.id %>">
                <span class="fs-4">â¬…ï¸</span>
            </a>
        </div>
        <div class="position-absolute top-50 start-50 translate-middle w-50 text-center">
            <div class="text-white fw-bold fs-5 text-truncate"><%= activity.name %></div>
        </div>
        <div class="d-flex align-items-center">
            <div class="dropdown">
                <button class="btn btn-link text-white text-decoration-none p-0 fs-3" type="button" data-bs-toggle="dropdown">âš™ï¸</button>
                <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0" style="min-width: 200px;">
                    <li><a class="dropdown-item" href="/activity/<%= activity.id %>">ğŸ  <span data-i18n="menu_return">è¿”å›è¨˜æ•¸</span></a></li>
                    <li><a class="dropdown-item" href="/activity/<%= activity.id %>/history">ğŸ“œ <span data-i18n="menu_history">æ­·å²ç´€éŒ„</span></a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><button class="dropdown-item" onclick="toggleLanguage()">ğŸŒ <span id="langLabel">ENG</span></button></li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<div class="container">
    <h4 class="mb-3">ğŸ‘¥ <span data-i18n="title">æœƒå“¡ç®¡ç†</span></h4>
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-striped mb-0 align-middle">
                <thead class="table-dark"><tr><th data-i18n="th_name">å§“å</th><th data-i18n="th_balance">ç›®å‰é¤˜é¡</th><th class="text-end" data-i18n="th_action">æ“ä½œ</th></tr></thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td class="fw-bold"><%= user.name %></td>
                            <td class="<%= user.balance < 0 ? 'text-danger' : 'text-success' %>">$<%= user.balance.toFixed(1) %></td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-success btn-deposit" data-id="<%= user.id %>" data-name="<%= user.name %>">ğŸ’° <span data-i18n="btn_deposit">å…¥éŒ¢</span></button>
                                <button class="btn btn-sm btn-outline-primary btn-edit-user" data-id="<%= user.id %>" data-name="<%= user.name %>"><span data-i18n="btn_rename">æ”¹å</span></button>
                                <button class="btn btn-sm btn-outline-danger btn-delete-user" data-id="<%= user.id %>" data-name="<%= user.name %>"><span data-i18n="btn_delete">åˆªé™¤</span></button>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="mt-3 text-muted small"><span data-i18n="hint_text">æç¤ºï¼šåˆªé™¤æœƒå“¡ä¸æœƒåˆªé™¤å…¶æ­·å²äº¤æ˜“ç´€éŒ„ï¼Œä½†æ­·å²ç´€éŒ„å°‡ä¸å†é¡¯ç¤ºè©²æœƒå“¡åç¨±ã€‚</span></div>
</div>

<div class="sticky-footer">
    <div class="container" style="max-width: 500px;">
        <button class="btn btn-primary w-100 py-2 fw-bold shadow-sm fs-5" type="button" data-bs-toggle="modal" data-bs-target="#addUserModal">â• <span data-i18n="btn_add_member_footer">åŠ æ–°æœƒå“¡</span></button>
    </div>
</div>

<div class="modal fade" id="addUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-primary">â• <span data-i18n="modal_add_title">åŠ æ–°æœƒå“¡</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/add-user" method="POST"><div class="modal-body"><div class="mb-3"><label class="form-label" data-i18n="label_name">æœƒå“¡åç¨±</label><input type="text" name="name" class="form-control" placeholder="Peter" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="btn_cancel">å–æ¶ˆ</button><button type="submit" class="btn btn-primary" data-i18n="btn_confirm_add">åŠ å…¥</button></div></form></div></div></div>
<div class="modal fade" id="depositModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-success">ğŸ’° <span data-i18n="modal_deposit_title">å…¥éŒ¢</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/deposit" method="POST"><div class="modal-body"><input type="hidden" name="userId" id="depositUserId"><p><span data-i18n="deposit_for">å…¥éŒ¢çµ¦ï¼š</span> <strong id="depositUserName" class="fs-5"></strong></p><div class="mb-3"><label class="form-label" data-i18n="label_amount">é‡‘é¡ $</label><input type="number" step="0.1" name="amount" class="form-control fw-bold fs-4" placeholder="100" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="btn_cancel">å–æ¶ˆ</button><button type="submit" class="btn btn-success" data-i18n="btn_confirm">ç¢ºå®šå…¥æ•¸</button></div></form></div></div></div>
<div class="modal fade" id="editUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">âœï¸ <span data-i18n="modal_edit_title">ä¿®æ”¹æœƒå“¡è³‡æ–™</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/edit-user" method="POST"><div class="modal-body"><input type="hidden" name="id" id="editUserId"><div class="mb-3"><label class="form-label" data-i18n="label_name">æœƒå“¡åç¨±</label><input type="text" name="name" id="editUserName" class="form-control" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="btn_cancel">å–æ¶ˆ</button><button type="submit" class="btn btn-primary" data-i18n="btn_save">ä¿å­˜</button></div></form></div></div></div>
<div class="modal fade" id="deleteUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-danger">âš ï¸ <span data-i18n="modal_delete_title">åˆªé™¤æœƒå“¡</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="/activity/<%= activity.id %>/delete-user" method="POST"><div class="modal-body"><input type="hidden" name="id" id="deleteUserId"><p><span data-i18n="confirm_delete_text">ç¢ºå®šè¦åˆªé™¤æœƒå“¡</span> <strong><span id="deleteUserName"></span></strong> <span data-i18n="question_mark">å—ï¼Ÿ</span></p><p class="text-danger small fw-bold" data-i18n="warning_irreversible">æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼</p></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="btn_cancel">å–æ¶ˆ</button><button type="submit" class="btn btn-danger" data-i18n="btn_confirm_delete">ç¢ºèªåˆªé™¤</button></div></form></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const translations = { zh: { title: "æœƒå“¡ç®¡ç†", th_name: "å§“å", th_balance: "ç›®å‰é¤˜é¡", th_action: "æ“ä½œ", btn_deposit: "å…¥éŒ¢", btn_rename: "æ”¹å", btn_delete: "åˆªé™¤", hint_text: "æç¤ºï¼šåˆªé™¤æœƒå“¡ä¸æœƒåˆªé™¤å…¶æ­·å²äº¤æ˜“ç´€éŒ„ã€‚", modal_deposit_title: "å…¥éŒ¢", deposit_for: "å…¥éŒ¢çµ¦ï¼š", label_amount: "é‡‘é¡ $", btn_confirm: "ç¢ºå®šå…¥æ•¸", modal_edit_title: "ä¿®æ”¹æœƒå“¡è³‡æ–™", label_name: "æœƒå“¡åç¨±", btn_cancel: "å–æ¶ˆ", btn_save: "ä¿å­˜", modal_delete_title: "åˆªé™¤æœƒå“¡", confirm_delete_text: "ç¢ºå®šè¦åˆªé™¤æœƒå“¡", question_mark: "å—ï¼Ÿ", warning_irreversible: "æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼", btn_confirm_delete: "ç¢ºèªåˆªé™¤", btn_add_member_footer: "åŠ æ–°æœƒå“¡", modal_add_title: "åŠ æ–°æœƒå“¡", btn_confirm_add: "åŠ å…¥", menu_return: "è¿”å›è¨˜æ•¸", menu_history: "æ­·å²ç´€éŒ„" }, en: { title: "Members", th_name: "Name", th_balance: "Balance", th_action: "Action", btn_deposit: "Deposit", btn_rename: "Rename", btn_delete: "Delete", hint_text: "Note: Deleting a member will not remove history.", modal_deposit_title: "Deposit", deposit_for: "Deposit for:", label_amount: "Amount $", btn_confirm: "Confirm", modal_edit_title: "Edit Member", label_name: "Name", btn_cancel: "Cancel", btn_save: "Save", modal_delete_title: "Delete Member", confirm_delete_text: "Delete member", question_mark: "?", warning_irreversible: "Irreversible!", btn_confirm_delete: "Delete", btn_add_member_footer: "Add Member", modal_add_title: "Add Member", btn_confirm_add: "Add", menu_return: "Back", menu_history: "History" } };
    let currentLang = localStorage.getItem('appLang') || 'zh';
    function applyLanguage() { const langData = translations[currentLang]; document.querySelectorAll('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); if (langData[key]) el.innerText = langData[key]; }); }
    function toggleLanguage() { currentLang = currentLang === 'zh' ? 'en' : 'zh'; localStorage.setItem('appLang', currentLang); applyLanguage(); }
    applyLanguage();
    var editUserModal = new bootstrap.Modal(document.getElementById('editUserModal')), deleteUserModal = new bootstrap.Modal(document.getElementById('deleteUserModal')), depositModal = new bootstrap.Modal(document.getElementById('depositModal'));
    document.querySelectorAll('.btn-deposit').forEach(b => b.addEventListener('click', function() { document.getElementById('depositUserId').value = this.dataset.id; document.getElementById('depositUserName').innerText = this.dataset.name; depositModal.show(); }));
    document.querySelectorAll('.btn-edit-user').forEach(b => b.addEventListener('click', function() { document.getElementById('editUserId').value = this.dataset.id; document.getElementById('editUserName').value = this.dataset.name; editUserModal.show(); }));
    document.querySelectorAll('.btn-delete-user').forEach(b => b.addEventListener('click', function() { document.getElementById('deleteUserId').value = this.dataset.id; document.getElementById('deleteUserName').innerText = this.dataset.name; deleteUserModal.show(); }));
</script>
</body>
</html>