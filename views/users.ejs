<!DOCTYPE html>
<html>
<head>
    <title>æœƒå“¡ç®¡ç†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="theme-color" content="#6c757d">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-secondary mb-3">
    <div class="container-fluid d-flex justify-content-between">
        <a class="navbar-brand" href="/activity/<%= activity.id %>">
            â¬…ï¸ <span data-i18n="nav_back">è¿”å›</span> <%= activity.name %>
        </a>
        <button class="btn btn-sm btn-outline-light" onclick="toggleLanguage()">ğŸŒ <span id="langLabel">EN</span></button>
    </div>
</nav>

<div class="container">
    <h4 class="mb-3">ğŸ‘¥ <span data-i18n="title">æœƒå“¡ç®¡ç†</span></h4>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-striped mb-0 align-middle">
                <thead class="table-dark">
                    <tr>
                        <th data-i18n="th_name">å§“å</th>
                        <th data-i18n="th_balance">ç›®å‰é¤˜é¡</th>
                        <th class="text-end" data-i18n="th_action">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td class="fw-bold"><%= user.name %></td>
                            <td class="<%= user.balance < 0 ? 'text-danger' : 'text-success' %>">
                                $<%= user.balance.toFixed(1) %>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-primary btn-edit-user"
                                        data-id="<%= user.id %>"
                                        data-name="<%= user.name %>">
                                    <span data-i18n="btn_rename">æ”¹å</span>
                                </button>
                                <button class="btn btn-sm btn-outline-danger btn-delete-user"
                                        data-id="<%= user.id %>"
                                        data-name="<%= user.name %>">
                                    <span data-i18n="btn_delete">åˆªé™¤</span>
                                </button>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="mt-3 text-muted small">
        <span data-i18n="hint_text">æç¤ºï¼šåˆªé™¤æœƒå“¡ä¸æœƒåˆªé™¤å…¶æ­·å²äº¤æ˜“ç´€éŒ„ï¼Œä½†æ­·å²ç´€éŒ„å°‡ä¸å†é¡¯ç¤ºè©²æœƒå“¡åç¨±ã€‚</span>
    </div>
</div>

<div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">âœï¸ <span data-i18n="modal_edit_title">ä¿®æ”¹æœƒå“¡è³‡æ–™</span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="/activity/<%= activity.id %>/edit-user" method="POST">
                <div class="modal-body">
                    <input type="hidden" name="id" id="editUserId">
                    <div class="mb-3">
                        <label class="form-label" data-i18n="label_name">æœƒå“¡åç¨±</label>
                        <input type="text" name="name" id="editUserName" class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="btn_cancel">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_save">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteUserModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">âš ï¸ <span data-i18n="modal_delete_title">åˆªé™¤æœƒå“¡</span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="/activity/<%= activity.id %>/delete-user" method="POST">
                <div class="modal-body">
                    <input type="hidden" name="id" id="deleteUserId">
                    <p><span data-i18n="confirm_delete_text">ç¢ºå®šè¦åˆªé™¤æœƒå“¡</span> <strong><span id="deleteUserName"></span></strong> <span data-i18n="question_mark">å—ï¼Ÿ</span></p>
                    <p class="text-danger small fw-bold" data-i18n="warning_irreversible">æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="btn_cancel">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-danger" data-i18n="btn_confirm_delete">ç¢ºèªåˆªé™¤</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- èªè¨€åˆ‡æ›é‚è¼¯ ---
    const translations = {
        zh: {
            nav_back: "è¿”å›",
            title: "æœƒå“¡ç®¡ç†",
            th_name: "å§“å",
            th_balance: "ç›®å‰é¤˜é¡",
            th_action: "æ“ä½œ",
            btn_rename: "æ”¹å",
            btn_delete: "åˆªé™¤",
            hint_text: "æç¤ºï¼šåˆªé™¤æœƒå“¡ä¸æœƒåˆªé™¤å…¶æ­·å²äº¤æ˜“ç´€éŒ„ï¼Œä½†æ­·å²ç´€éŒ„å°‡ä¸å†é¡¯ç¤ºè©²æœƒå“¡åç¨±ã€‚",
            modal_edit_title: "ä¿®æ”¹æœƒå“¡è³‡æ–™",
            label_name: "æœƒå“¡åç¨±",
            btn_cancel: "å–æ¶ˆ",
            btn_save: "ä¿å­˜",
            modal_delete_title: "åˆªé™¤æœƒå“¡",
            confirm_delete_text: "ç¢ºå®šè¦åˆªé™¤æœƒå“¡",
            question_mark: "å—ï¼Ÿ",
            warning_irreversible: "æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼",
            btn_confirm_delete: "ç¢ºèªåˆªé™¤"
        },
        en: {
            nav_back: "Back to",
            title: "Members",
            th_name: "Name",
            th_balance: "Balance",
            th_action: "Action",
            btn_rename: "Rename",
            btn_delete: "Delete",
            hint_text: "Note: Deleting a member will not remove their historical transactions.",
            modal_edit_title: "Edit Member",
            label_name: "Name",
            btn_cancel: "Cancel",
            btn_save: "Save",
            modal_delete_title: "Delete Member",
            confirm_delete_text: "Are you sure you want to delete",
            question_mark: "?",
            warning_irreversible: "This action cannot be undone!",
            btn_confirm_delete: "Confirm Delete"
        }
    };

    let currentLang = localStorage.getItem('appLang') || 'zh';

    function applyLanguage() {
        const langData = translations[currentLang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (langData[key]) el.innerText = langData[key];
        });
        document.getElementById('langLabel').innerText = currentLang === 'zh' ? 'EN' : 'ä¸­';
    }

    function toggleLanguage() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        localStorage.setItem('appLang', currentLang);
        applyLanguage();
    }

    applyLanguage();

    // --- åŸæœ‰ Modal é‚è¼¯ ---
    var editUserModal = new bootstrap.Modal(document.getElementById('editUserModal'));
    var deleteUserModal = new bootstrap.Modal(document.getElementById('deleteUserModal'));

    document.querySelectorAll('.btn-edit-user').forEach(button => {
        button.addEventListener('click', function() {
            document.getElementById('editUserId').value = this.getAttribute('data-id');
            document.getElementById('editUserName').value = this.getAttribute('data-name');
            editUserModal.show();
        });
    });

    document.querySelectorAll('.btn-delete-user').forEach(button => {
        button.addEventListener('click', function() {
            document.getElementById('deleteUserId').value = this.getAttribute('data-id');
            document.getElementById('deleteUserName').innerText = this.getAttribute('data-name');
            deleteUserModal.show();
        });
    });
</script>

</body>
</html>